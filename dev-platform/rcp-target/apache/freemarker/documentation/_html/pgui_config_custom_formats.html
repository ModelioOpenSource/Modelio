<!doctype html>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
&quot;License&quot;); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
&quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!-- Generated by FreeMarker/Docgen from DocBook -->
<html lang="en" class="page-type-section">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<title>Custom number and date/time formats - Apache FreeMarker Manual</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="format-detection" content="telephone=no">
<meta property="og:site_name" content="Apache FreeMarker Manual">
<meta property="og:title" content="Custom number and date/time formats">
<meta property="og:locale" content="en_US">
<meta property="og:url" content="https://freemarker.apache.org/docs/pgui_config_custom_formats.html">
<link rel="canonical" href="https://freemarker.apache.org/docs/pgui_config_custom_formats.html">
<link rel="icon" href="favicon.png" type="image/png">
<link rel="stylesheet" type="text/css" href="docgen-resources/docgen.min.css?1612906439515">
</head>
<body itemscope itemtype="https://schema.org/Code">
    <meta itemprop="url" content="https://freemarker.apache.org/docs/">
    <meta itemprop="name" content="Apache FreeMarker Manual">

  <!--[if lte IE 9]>
  <div class="oldBrowserWarning" style="display: block">
    Unsupported web browser - Use a modern browser to view this website!
  </div>
  <![endif]-->  <div class="oldBrowserWarning">
    Unsupported web browser - Use a modern browser to view this website!
  </div>
<div class="header-top-bg"><div class="site-width header-top"><div id="hamburger-menu" role="button"></div>          <div class="logo">
<a href="https://freemarker.apache.org" role="banner"><img itemprop="image" src="logo.png" alt="FreeMarker"></a>          </div>
<ul class="tabs"><li><a href="https://freemarker.apache.org/">Home</a></li><li class="current"><a href="index.html">Manual</a></li><li><a class="external" href="api/index.html">Java API</a></li></ul><ul class="secondary-tabs"><li><a class="tab icon-heart" href="https://freemarker.apache.org/contribute.html" title="Contribute"><span>Contribute</span></a></li><li><a class="tab icon-bug" href="https://issues.apache.org/jira/browse/FREEMARKER/" title="Report a Bug"><span>Report a Bug</span></a></li><li><a class="tab icon-download" href="https://freemarker.apache.org/freemarkerdownload.html" title="Download"><span>Download</span></a></li></ul></div></div><div class="header-bottom-bg"><div class="site-width search-row"><a href="toc.html" class="navigation-header">Manual</a><div class="navigation-header"></div></div><div class="site-width breadcrumb-row">  <div class="breadcrumbs">
<ul class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList"><li class="step-0" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a class="label" itemprop="item" href="toc.html"><span itemprop="name">Apache FreeMarker Manual</span></a></li><li class="step-1" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a class="label" itemprop="item" href="pgui.html"><span itemprop="name">Programmer&#39;s Guide</span></a></li><li class="step-2" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a class="label" itemprop="item" href="pgui_config.html"><span itemprop="name">The Configuration</span></a></li><li class="step-3" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a class="label" itemprop="item" href="pgui_config_custom_formats.html"><span itemprop="name">Custom number and date/time formats</span></a></li></ul>  </div>
<div class="bookmarks" title="Bookmarks"><span class="sr-only">Bookmarks:</span><ul><li><a href="alphaidx.html">Alpha. index</a></li><li><a href="gloss.html">Glossary</a></li><li><a href="dgui_template_exp.html#exp_cheatsheet">Expressions</a></li><li><a href="ref_builtins_alphaidx.html">?builtins</a></li><li><a href="ref_directive_alphaidx.html">#directives</a></li><li><a href="ref_specvar.html">.spec_vars</a></li><li><a href="app_faq.html">FAQ</a></li></ul></div></div></div>    <div class="main-content site-width">
      <div class="content-wrapper">
  <div id="table-of-contents-wrapper" class="col-left">
      <script>var breadcrumb = ["Apache FreeMarker Manual","Programmer\'s Guide","The Configuration","Custom number and date/time formats"];</script>
      <script src="toc.js?1612906439515"></script>
      <script src="docgen-resources/main.min.js?1612906439515"></script>
  </div>
<div class="col-right"><div class="page-content"><div class="page-title"><div class="pagers top"><a class="paging-arrow previous" href="pgui_config_outputformatsautoesc.html"><span>Previous</span></a><a class="paging-arrow next" href="pgui_config_incompatible_improvements.html"><span>Next</span></a></div><div class="title-wrapper">
<h1 class="content-header header-section1" id="pgui_config_custom_formats" itemprop="headline">Custom number and date/time formats</h1>
</div></div><div class="page-menu">
<div class="page-menu-title">Page Contents</div>
<ul><li><a class="page-menu-link" href="#autoid_50" data-menu-target="autoid_50">Overview</a></li><li><a class="page-menu-link" href="#pgui_config_custom_formats_ex_cust_alg_simple" data-menu-target="pgui_config_custom_formats_ex_cust_alg_simple">Simple custom number format example</a></li><li><a class="page-menu-link" href="#pgui_config_custom_formats_ex_cust_algo_advanced" data-menu-target="pgui_config_custom_formats_ex_cust_algo_advanced">Advanced custom number format example</a></li><li><a class="page-menu-link" href="#pgui_config_custom_formats_ex_cust_algo_date" data-menu-target="pgui_config_custom_formats_ex_cust_algo_date">Custom date/time format example</a></li><li><a class="page-menu-link" href="#pgui_config_custom_formats_ex_alias" data-menu-target="pgui_config_custom_formats_ex_alias">Alias format example</a></li><li><a class="page-menu-link" href="#pgui_config_custom_formats_ex_model_aware" data-menu-target="pgui_config_custom_formats_ex_model_aware">Model-aware format example</a></li></ul> </div>
          



<h2 class="content-header header-section2" id="autoid_50">Overview</h2>


            <div class="callout note">
    <strong class="callout-label">Note:</strong>

            <p>Custom formats (of the kind described here) exists since
            FreeMarker 2.3.24.</p>
            </div>


          <p>FreeMarker allows you to define your own number and
          date/time/datetime formats, and associate a name to them. This
          mechanism has several applications:</p>

          <ul>
            <li>
              <p>Custom formatter algorithms: You can use your own
              formatter algorithm instead of relying on those provided by
              FreeMarker. For this, implement
              <code class="inline-code">freemarker.core.TemplateNumberFormatFactory</code>
              or <code class="inline-code">freemarker.core.TemplateDateFormatFactory</code>.
              You will find a few examples of this <a href="#pgui_config_custom_formats_ex_cust_alg_simple">below</a>.</p>
            </li>

            <li>
              <p>Aliasing: You can give application-specific names (like
              "price", "weight",
              "fileDate", "logEventTime", etc.) to
              other formats by using
              <code class="inline-code">AliasTemplateNumberFormatFactory</code> and
              <code class="inline-code">AliasTemplateDateFormatFactory</code>. Thus
              templates can just refer to that name, like in
              <code class="inline-code">${lastModified?string.@fileDate}</code>, instead of
              specifying the format directly. Thus the formats can be
              specified on a single central place (where you configure
              FreeMarker), instead of being specified repeatedly in templates.
              Also thus template authors don&#39;t have to enter complex and hard
              to remember formatting patterns. <a href="#pgui_config_custom_formats_ex_alias">See example
              below</a>.</p>
            </li>

            <li>
              <p>Model-sensitive formatting: Applications can put custom
              <code class="inline-code">freemarker.TemplateModel</code>-s into the
              data-model instead of dropping plain values (like
              <code class="inline-code">int</code>-s, <code class="inline-code">double</code>-s, etc.)
              into it, to attach rendering-related information to the value.
              Custom formatters can utilize this information (for example, to
              show the unit after numbers), as they receive the
              <code class="inline-code">TemplateModel</code> itself, not the wrapped raw
              value. <a href="#pgui_config_custom_formats_ex_model_aware">See example
              below</a>.</p>
            </li>

            <li>
              <p>Format that prints markup instead of plain text: You might
              want to use HTML tags (or other markup) in the formatted values,
              such as coloring negative numbers to red or using HTML
              <code class="inline-code">sup</code> element for exponents. This is possible
              if you write a custom format as shown in previous cases, but
              override the <code class="inline-code">format</code> method in the formatter
              class so that it returns a
              <code class="inline-code">TemplateMarkupOutputModel</code> instead of a
              <code class="inline-code">String</code>. (You shouldn&#39;t just return the markup
              as <code class="inline-code">String</code>, as then it might will be escaped;
              see <a href="dgui_misc_autoescaping.html">auto-escaping</a>.)</p>
            </li>
          </ul>

          <p>Custom formats can be registered with the
          <code class="inline-code">custom_number_formats</code> and
          <code class="inline-code">custom_date_formats</code> configuration settings. After
          that, anywhere where you can specify formats with a
          <code class="inline-code">String</code>, now you can refer to your custom format
          as <code class="inline-code">&quot;@<em class="code-color">name</em>&quot;</code>. So for
          example, if you have registered your number format implementation
          with name <code class="inline-code">&quot;smart&quot;</code>, then you could set the
          <code class="inline-code">number_format</code> setting
          (<code class="inline-code">Configurable.setNumberFormat(String)</code>) to
          <code class="inline-code">&quot;@smart&quot;</code>, or issue
          <code class="inline-code">${n?string.@smart}</code> or <code class="inline-code">&lt;#setting
          number_format=&quot;@smart&quot;&gt;</code> in a template. Furthermore, you
          can define parameters for your custom format, like <code class="inline-code">&quot;@smart
          2&quot;</code>, and the interpretation of the parameters is up to your
          formatter implementation.</p>
        
          



<h2 class="content-header header-section2" id="pgui_config_custom_formats_ex_cust_alg_simple">Simple custom number format example</h2>


          <p>This custom number format shows numbers in hexadecimal
          form:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">package com.example;

import java.util.Locale;

import freemarker.template.TemplateModelException;
import freemarker.template.TemplateNumberModel;
import freemarker.template.utility.NumberUtil;

public class HexTemplateNumberFormatFactory extends TemplateNumberFormatFactory {

    public static final HexTemplateNumberFormatFactory INSTANCE
            = new HexTemplateNumberFormatFactory();

    private HexTemplateNumberFormatFactory() {
        // Defined to decrease visibility
    }

    @Override
    public TemplateNumberFormat get(String params, Locale locale, Environment env)
            throws InvalidFormatParametersException {
        TemplateFormatUtil.checkHasNoParameters(params);
        return HexTemplateNumberFormat.INSTANCE;
    }

    private static class HexTemplateNumberFormat extends TemplateNumberFormat {

        private static final HexTemplateNumberFormat INSTANCE = new HexTemplateNumberFormat();

        private HexTemplateNumberFormat() { }

        @Override
        public String formatToPlainText(TemplateNumberModel numberModel)
                throws UnformattableValueException, TemplateModelException {
            Number n = TemplateFormatUtil.getNonNullNumber(numberModel);
            try {
                return Integer.toHexString(NumberUtil.toIntExact(n));
            } catch (ArithmeticException e) {
                throw new UnformattableValueException(n + &quot; doesn&#39;t fit into an int&quot;);
            }
        }

        @Override
        public boolean isLocaleBound() {
            return false;
        }

        @Override
        public String getDescription() {
            return &quot;hexadecimal int&quot;;
        }

    }

}</pre>    </div>


          <p>We register the above format with name
          "hex":</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">// Where you initalize the application-wide Configuration singleton:
Configuration cfg = ...;
...
Map&lt;String, TemplateNumberFormatFactory&gt; customNumberFormats = ...;
...
customNumberFormats.put(&quot;hex&quot;, HexTemplateNumberFormatFactory.INSTANCE);
...
cfg.setCustomNumberFormats(customNumberFormats);</pre>    </div>


          <p>Now we can use this format in templates:</p>

          

    <div class="code-block role-template">
<div class="code-block-label">Template</div><pre class="code-block-body">${x?string.@hex}</pre>    </div>


          <p>or even set it as the default number format:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">cfg.setNumberFormat(&quot;@hex&quot;);</pre>    </div>

        
          



<h2 class="content-header header-section2" id="pgui_config_custom_formats_ex_cust_algo_advanced">Advanced custom number format example</h2>


          <p>This is a more complex custom number format that shows how to
          deal with parameters in the format string, also how to delegate to
          another format:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">package com.example;

import java.util.Locale;

import freemarker.template.TemplateModelException;
import freemarker.template.TemplateNumberModel;
import freemarker.template.utility.NumberUtil;
import freemarker.template.utility.StringUtil;

/**
 * Shows a number in base N number system. Can only format numbers that fit into an {@code int},
 * however, optionally you can specify a fallback format. This format has one required parameter,
 * the numerical system base. That can be optionally followed by &quot;|&quot; and a fallback format.
 */
public class BaseNTemplateNumberFormatFactory extends TemplateNumberFormatFactory {

    public static final BaseNTemplateNumberFormatFactory INSTANCE
            = new BaseNTemplateNumberFormatFactory();

    private BaseNTemplateNumberFormatFactory() {
        // Defined to decrease visibility
    }

    @Override
    public TemplateNumberFormat get(String params, Locale locale, Environment env)
            throws InvalidFormatParametersException {
        TemplateNumberFormat fallbackFormat;
        {
            int barIdx = params.indexOf(&#39;|&#39;);
            if (barIdx != -1) {
                String fallbackFormatStr = params.substring(barIdx + 1);
                params = params.substring(0, barIdx);
                try {
                    fallbackFormat = env.getTemplateNumberFormat(fallbackFormatStr, locale);
                } catch (TemplateValueFormatException e) {
                    throw new InvalidFormatParametersException(
                            &quot;Couldn&#39;t get the fallback number format (specified after the \&quot;|\&quot;), &quot;
                            + StringUtil.jQuote(fallbackFormatStr) + &quot;. Reason: &quot; + e.getMessage(),
                            e);
                }
            } else {
                fallbackFormat = null;
            }
        }

        int base;
        try {
            base = Integer.parseInt(params);
        } catch (NumberFormatException e) {
            if (params.length() == 0) {
                throw new InvalidFormatParametersException(
                        &quot;A format parameter is required to specify the numerical system base.&quot;);
            }
            throw new InvalidFormatParametersException(
                    &quot;The format paramter must be an integer, but was (shown quoted): &quot;
                    + StringUtil.jQuote(params));
        }
        if (base &lt; 2) {
            throw new InvalidFormatParametersException(&quot;A base must be at least 2.&quot;);
        }
        return new BaseNTemplateNumberFormat(base, fallbackFormat);
    }

    private static class BaseNTemplateNumberFormat extends TemplateNumberFormat {

        private final int base;
        private final TemplateNumberFormat fallbackFormat;

        private BaseNTemplateNumberFormat(int base, TemplateNumberFormat fallbackFormat) {
            this.base = base;
            this.fallbackFormat = fallbackFormat;
        }

        @Override
        public String formatToPlainText(TemplateNumberModel numberModel)
                throws TemplateModelException, TemplateValueFormatException {
            Number n = TemplateFormatUtil.getNonNullNumber(numberModel);
            try {
                return Integer.toString(NumberUtil.toIntExact(n), base);
            } catch (ArithmeticException e) {
                if (fallbackFormat == null) {
                    throw new UnformattableValueException(
                            n + &quot; doesn&#39;t fit into an int, and there was no fallback format &quot;
                            + &quot;specified.&quot;);
                } else {
                    return fallbackFormat.formatToPlainText(numberModel);
                }
            }
        }

        @Override
        public boolean isLocaleBound() {
            return false;
        }

        @Override
        public String getDescription() {
            return &quot;base &quot; + base;
        }

    }

}</pre>    </div>


          <p>We register the above format with name
          "base":</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">// Where you initalize the application-wide Configuration singleton:
Configuration cfg = ...;
...
Map&lt;String, TemplateNumberFormatFactory&gt; customNumberFormats = ...;
...
customNumberFormats.put(&quot;base&quot;, BaseNTemplateNumberFormatFactory.INSTANCE);
...
cfg.setCustomNumberFormats(customNumberFormats);</pre>    </div>


          <p>Now we can use this format in templates:</p>

          

    <div class="code-block role-template">
<div class="code-block-label">Template</div><pre class="code-block-body">${x?string.@base_8}</pre>    </div>


          <p>Above there the parameter string was <code class="inline-code">&quot;8&quot;</code>,
          as FreeMarker allows separating that from the format name with
          <code class="inline-code">_</code> instead of whitespace, so that you don&#39;t have
          to write the longer
          <code class="inline-code"><em class="code-color">n</em>?string[&quot;@base 8&quot;]</code>
          form.</p>

          <p>Of course, we could also set this as the default number format
          like:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">cfg.setNumberFormat(&quot;@base 8&quot;);</pre>    </div>


          <p>Here&#39;s an example of using the a fallback number format (which
          is <code class="inline-code">&quot;0.0###&quot;</code>):</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">cfg.setNumberFormat(&quot;@base 8|0.0###&quot;);</pre>    </div>


          <p>Note that this functionality, with the <code class="inline-code">|</code>
          syntax and all, is purely implemented in the example code
          earlier.</p>
        
          



<h2 class="content-header header-section2" id="pgui_config_custom_formats_ex_cust_algo_date">Custom date/time format example</h2>


          <p>This simple date format formats the date/time value to the
          milliseconds since the epoch:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">package com.example;

import java.util.Date;
import java.util.Locale;
import java.util.TimeZone;

import freemarker.template.TemplateDateModel;
import freemarker.template.TemplateModelException;

public class EpochMillisTemplateDateFormatFactory extends TemplateDateFormatFactory {

    public static final EpochMillisTemplateDateFormatFactory INSTANCE
            = new EpochMillisTemplateDateFormatFactory();

    private EpochMillisTemplateDateFormatFactory() {
        // Defined to decrease visibility
    }

    @Override
    public TemplateDateFormat get(String params, int dateType,
            Locale locale, TimeZone timeZone, boolean zonelessInput,
            Environment env)
            throws InvalidFormatParametersException {
        TemplateFormatUtil.checkHasNoParameters(params);
        return EpochMillisTemplateDateFormat.INSTANCE;
    }

    private static class EpochMillisTemplateDateFormat extends TemplateDateFormat {

        private static final EpochMillisTemplateDateFormat INSTANCE
                = new EpochMillisTemplateDateFormat();

        private EpochMillisTemplateDateFormat() { }

        @Override
        public String formatToPlainText(TemplateDateModel dateModel)
                throws UnformattableValueException, TemplateModelException {
            return String.valueOf(TemplateFormatUtil.getNonNullDate(dateModel).getTime());
        }

        @Override
        public boolean isLocaleBound() {
            return false;
        }

        @Override
        public boolean isTimeZoneBound() {
            return false;
        }

        @Override
        public Date parse(String s, int dateType) throws UnparsableValueException {
            try {
                return new Date(Long.parseLong(s));
            } catch (NumberFormatException e) {
                throw new UnparsableValueException(&quot;Malformed long&quot;);
            }
        }

        @Override
        public String getDescription() {
            return &quot;millis since the epoch&quot;;
        }

    }

}</pre>    </div>


          <p>We register the above format with name
          "epoch":</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">// Where you initalize the application-wide Configuration singleton:
Configuration cfg = ...;
...
Map&lt;String, TemplateDateFormatFactory&gt; customDateFormats = ...;
...
customDateFormats.put(&quot;epoch&quot;, EpochMillisTemplateDateFormatFactory.INSTANCE);
...
cfg.setCustomDateFormats(customDateFormats);</pre>    </div>


          <p>Now we can use this format in templates:</p>

          

    <div class="code-block role-template">
<div class="code-block-label">Template</div><pre class="code-block-body">${t?string.@epoch}</pre>    </div>


          <p>Of course, we could also set this as the default date-time
          format like:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">cfg.setDateTimeFormat(&quot;@epoch&quot;);</pre>    </div>


          <p>For a more complex that for example uses format parameters,
          refer to the <a href="#pgui_config_custom_formats_ex_cust_algo_advanced">advanced
          number format example</a>. Doing that with date formats is very
          similar.</p>
        
          



<h2 class="content-header header-section2" id="pgui_config_custom_formats_ex_alias">Alias format example</h2>


          <p>In this example we specify some number formats and date
          formats that are aliases to another format:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">// Where you initalize the application-wide Configuration singleton:
Configuration cfg = ...;

Map&lt;String, TemplateNumberFormatFactory&gt; customNumberFormats
        = new HashMap&lt;String, TemplateNumberFormatFactory&gt;();
customNumberFormats.put(&quot;price&quot;, new AliasTemplateNumberFormatFactory(&quot;,000.00&quot;));
customNumberFormats.put(&quot;weight&quot;,
        new AliasTemplateNumberFormatFactory(&quot;0.##;; roundingMode=halfUp&quot;));
cfg.setCustomNumberFormats(customNumberFormats);

Map&lt;String, TemplateDateFormatFactory&gt; customDateFormats
        = new HashMap&lt;String, TemplateDateFormatFactory&gt;();
customDateFormats.put(&quot;fileDate&quot;, new AliasTemplateDateFormatFactory(&quot;dd/MMM/yy hh:mm a&quot;));
customDateFormats.put(&quot;logEventTime&quot;, new AliasTemplateDateFormatFactory(&quot;iso ms u&quot;));
cfg.setCustomDateFormats(customDateFormats);</pre>    </div>


          <p>So now you can do this in a template:</p>

          

    <div class="code-block role-template">
<div class="code-block-label">Template</div><pre class="code-block-body">${product.price?string.@price}
${product.weight?string.@weight}
${lastModified?string.@fileDate}
${lastError.timestamp?string.@logEventTime}</pre>    </div>


          <p>Note that the constructor parameter of
          <code class="inline-code">AliasTemplateNumberFormatFactory</code> can naturally
          refer to a custom format too:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">Map&lt;String, TemplateNumberFormatFactory&gt; customNumberFormats
        = new HashMap&lt;String, TemplateNumberFormatFactory&gt;();
customNumberFormats.put(&quot;base&quot;, BaseNTemplateNumberFormatFactory.INSTANCE);
customNumberFormats.put(&quot;oct&quot;, new AliasTemplateNumberFormatFactory(&quot;@base 8&quot;));
cfg.setCustomNumberFormats(customNumberFormats);</pre>    </div>


          <p>So now
          <code class="inline-code"><em class="code-color">n</em>?string.@oct</code> will
          format the number to octal form.</p>
        
          



<h2 class="content-header header-section2" id="pgui_config_custom_formats_ex_model_aware">Model-aware format example</h2>


          <p>In this example we specify a number format that automatically
          show the unit after the number if that was put into the data-model
          as <code class="inline-code">UnitAwareTemplateNumberModel</code>. First let&#39;s see
          <code class="inline-code">UnitAwareTemplateNumberModel</code>:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">package com.example;

import freemarker.template.TemplateModelException;
import freemarker.template.TemplateNumberModel;

public class UnitAwareTemplateNumberModel implements TemplateNumberModel {

    private final Number value;
    private final String unit;

    public UnitAwareTemplateNumberModel(Number value, String unit) {
        this.value = value;
        this.unit = unit;
    }

    @Override
    public Number getAsNumber() throws TemplateModelException {
        return value;
    }

    public String getUnit() {
        return unit;
    }

}</pre>    </div>


          <p>When you fill the data-model, you could do something like
          this:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">Map&lt;String, Object&gt; dataModel = new HashMap&lt;&gt;();
dataModel.put(&quot;weight&quot;, new UnitAwareTemplateNumberModel(1.5, &quot;kg&quot;));
// Rather than just: dataModel.put(&quot;weight&quot;, 1.5);</pre>    </div>


          <p>Then if we have this in the template:</p>

          

    <div class="code-block role-template">
<div class="code-block-label">Template</div><pre class="code-block-body">${weight}</pre>    </div>


          <p>we want to see this:</p>

          

    <div class="code-block role-output">
<div class="code-block-label">Output</div><pre class="code-block-body">1.5 kg</pre>    </div>


          <p>To achieve that, we define this custom number format:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">package com.example;

import java.util.Locale;

import freemarker.core.Environment;
import freemarker.core.TemplateNumberFormat;
import freemarker.core.TemplateNumberFormatFactory;
import freemarker.core.TemplateValueFormatException;
import freemarker.template.TemplateModelException;
import freemarker.template.TemplateNumberModel;

/**
 * A number format that takes any other number format as parameter (specified as a string, as
 * usual in FreeMarker), then if the model is a {@link UnitAwareTemplateNumberModel}, it  shows
 * the unit after the number formatted with the other format, otherwise it just shows the formatted
 * number without unit.
 */
public class UnitAwareTemplateNumberFormatFactory extends TemplateNumberFormatFactory {

    public static final UnitAwareTemplateNumberFormatFactory INSTANCE
            = new UnitAwareTemplateNumberFormatFactory();

    private UnitAwareTemplateNumberFormatFactory() {
        // Defined to decrease visibility
    }

    @Override
    public TemplateNumberFormat get(String params, Locale locale, Environment env)
            throws TemplateValueFormatException {
        return new UnitAwareNumberFormat(env.getTemplateNumberFormat(params, locale));
    }

    private static class UnitAwareNumberFormat extends TemplateNumberFormat {

        private final TemplateNumberFormat innerFormat;

        private UnitAwareNumberFormat(TemplateNumberFormat innerFormat) {
            this.innerFormat = innerFormat;
        }

        @Override
        public String formatToPlainText(TemplateNumberModel numberModel)
                throws TemplateModelException, TemplateValueFormatException {
            String innerResult = innerFormat.formatToPlainText(numberModel);
            return numberModel instanceof UnitAwareTemplateNumberModel
                    ? innerResult + &quot; &quot; + ((UnitAwareTemplateNumberModel) numberModel).getUnit()
                    : innerResult;
        }

        @Override
        public boolean isLocaleBound() {
            return innerFormat.isLocaleBound();
        }

        @Override
        public String getDescription() {
            return &quot;unit-aware &quot; + innerFormat.getDescription();
        }

    }

}</pre>    </div>


          <p>Finally, we set the above custom format as the default number
          format:</p>

          

    <div class="code-block role-unspecified">
<pre class="code-block-body">// Where you initalize the application-wide Configuration singleton:
Configuration cfg = ...;

Map&lt;String, TemplateNumberFormatFactory&gt; customNumberFormats = new HashMap&lt;&gt;();
customNumberFormats.put(&quot;ua&quot;, UnitAwareTemplateNumberFormatFactory.INSTANCE);
cfg.setCustomNumberFormats(customNumberFormats);

// Note: &quot;0.####;; roundingMode=halfUp&quot; is a standard format specified in FreeMarker.
cfg.setNumberFormat(&quot;@ua 0.####;; roundingMode=halfUp&quot;);</pre>    </div>

        <div class="bottom-pagers-wrapper"><div class="pagers bottom"><a class="paging-arrow previous" href="pgui_config_outputformatsautoesc.html"><span>Previous</span></a><a class="paging-arrow next" href="pgui_config_incompatible_improvements.html"><span>Next</span></a></div></div></div></div>      </div>
    </div>
<div class="site-footer"><div class="site-width"><div class="footer-top"><div class="col-left sitemap"><div class="column"><h3 class="column-header">Overview</h3><ul><li><a href="https://freemarker.apache.org/">What is FreeMarker?</a></li><li><a href="https://freemarker.apache.org/freemarkerdownload.html">Download</a></li><li><a href="app_versions.html">Version history</a></li><li><a href="https://freemarker.apache.org/history.html">About us</a></li><li><a itemprop="license" href="app_license.html">License</a></li></ul></div><div class="column"><h3 class="column-header">Handy stuff</h3><ul><li><a href="http://try.freemarker.org/">Try template online</a></li><li><a href="dgui_template_exp.html#exp_cheatsheet">Expressions cheatsheet</a></li><li><a href="ref_directive_alphaidx.html">#directives</a></li><li><a href="ref_builtins_alphaidx.html">?built_ins</a></li><li><a href="ref_specvar.html">.special_vars</a></li></ul></div><div class="column"><h3 class="column-header">Community</h3><ul><li><a href="https://github.com/freemarker/freemarker">FreeMarker on Github</a></li><li><a href="https://twitter.com/freemarker">Follow us on Twitter</a></li><li><a href="https://issues.apache.org/jira/browse/FREEMARKER/">Report a bug</a></li><li><a href="https://stackoverflow.com/questions/ask?tags=freemarker">Ask a question</a></li><li><a href="https://freemarker.apache.org/mailing-lists.html">Mailing lists</a></li></ul></div></div><div class="col-right"><ul class="social-icons"><li><a class="github" href="https://github.com/freemarker/freemarker">Github</a></li><li><a class="twitter" href="https://twitter.com/freemarker">Twitter</a></li><li><a class="stack-overflow" href="https://stackoverflow.com/questions/ask?tags=freemarker">Stack Overflow</a></li></ul><a class="xxe" href="http://www.xmlmind.com/xmleditor/" rel="nofollow" title="Edited with XMLMind XML Editor"><span>Edited with XMLMind XML Editor</span></a></div></div><div class="footer-bottom"> <p class="last-generated">
Last generated:
<time itemprop="dateModified" datetime="2021-02-09T21:33:59Z" title="Tuesday, February 9, 2021 9:33:59 PM GMT">2021-02-09 21:33:59 GMT</time>, for Freemarker 2.3.31 </p>
<p class="copyright">
© <span itemprop="copyrightYear">1999</span>–2021
<a itemtype="http://schema.org/Organization" itemprop="copyrightHolder" href="https://apache.org/">The Apache Software Foundation</a>. Apache FreeMarker, FreeMarker, Apache Incubator, Apache, the Apache FreeMarker logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p>
</div></div></div></body>
</html>
